<!-- templates/shopper_timeline.html -->

{% extends "base.html" %}
{% block title %}Order Timeline{% endblock %}
{% block content %}
<h2><u>Timeline</u></h2>
<div class="timeline">
    {% set steps = ['Shopping in U-Store', 'Checked Out', 'On Delivery', 'Delivered'] %}
    {% for step in steps %}
    <div class="step" id="{{ step|lower|replace(' ', '-') }}-step">
        <input type="checkbox" disabled
               {% if order['timeline'].get(step, False) %}checked{% endif %}>
        <span class="step-text">{{ step }}</span>
    </div>
    {% endfor %}
</div>

<script>
    function refreshTimeline() {
        fetch("{{ url_for('order_status', order_id=order['id']) }}")
            .then(response => response.json())
            .then(data => {
                const timeline = data.timeline;
                const steps = ['Shopping in U-Store', 'Checked Out', 'On Delivery', 'Delivered'];
                steps.forEach(step => {
                    const checkbox = document.querySelector(`div#${step.toLowerCase().replace(/ /g, '-')}-step input`);
                    if (checkbox) {
                        checkbox.checked = timeline[step];
                    }
                });
            })
            .catch(error => console.error("Error fetching order status:", error));
    }

    // Refresh the timeline every 10 seconds
    setInterval(refreshTimeline, 10000);
    // Initial call to display current status
    refreshTimeline();
</script>
{% endblock %}
