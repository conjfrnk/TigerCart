{% extends "base.html" %}
{% block title %}Delivery Timeline{% endblock %}

{% block content %}
<h1>Delivery Timeline</h1>

<hr color="#ff5722">

<h2><u>Items</u></h2>
<ul>
    <table style="border: 1px solid black; border-collapse: collapse;" align="center">
        <thead style="border: 1px solid black;">
            <tr>
                <td style="border: 1px solid black;"><strong>Item</strong></td>
                <td style="border: 1px solid black;"><strong>Quantity</strong></td>
                <td style="border: 1px solid black;"><strong>Collected</strong></td>
            </tr>
        </thead>
        <tbody style="border: 1px solid black;">
            {% for item_id, item in items.items() %}
            <tr>
                <td style="border: 1px solid black;">{{ item.name }}</td>
                <td style="border: 1px solid black;">{{ item.quantity }}</td>
                <td style="border: 1px solid black;">
                    <input type="checkbox" onclick="updateChecklist('item', '{{ item_id }}', this.checked)"
                           {% if item.checked %}checked{% endif %}>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</ul>

<hr color="#ff5722">

<h2><u>Timeline</u></h2>
<div class="timeline">
    {% set steps = ['Shopping in U-Store', 'Checked Out', 'On Delivery', 'Delivered'] %}
    {% for step in steps %}
    <div class="step" id="{{ step|lower|replace(' ', '-') }}-step">
        <input type="checkbox" onclick="updateChecklist('timeline', '{{ step|lower|replace(' ', '_') }}', this.checked)"
               {% if step in timeline and timeline[step] %}checked{% endif %}>
        <span class="step-text">{{ step }}</span>
    </div>
    {% endfor %}
</div>

<script>
    function updateChecklist(type, id, checked) {
        fetch(`/update_checklist`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                order_id: "{{ order.id }}",
                type: type,
                id: id,
                checked: checked
            })
        }).then(response => response.json())
          .then(data => {
              if (!data.success) {
                  alert("Failed to update the checklist.");
              }
          }).catch(error => console.error("Error updating checklist:", error));
    }
</script>
{% endblock %}
